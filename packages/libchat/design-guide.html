<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>libchat Design Guide</title>
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      :root {
        --g-bg: #f5f5f5;
        --g-card: white;
        --g-muted: #f9fafb;
        --g-border: #e5e7eb;
        --g-text: #1f2937;
        --g-dim: #6b7280;
        --g-accent: #2563eb;
      }
      body.dark {
        --g-bg: #0a0a0a;
        --g-card: #111827;
        --g-muted: #1f2937;
        --g-border: #374151;
        --g-text: #f9fafb;
        --g-dim: #9ca3af;
      }

      body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: var(--g-bg);
        color: var(--g-text);
      }

      .guide-header {
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 24px;
        background: var(--g-card);
        border-bottom: 1px solid var(--g-border);
      }
      .guide-header h1 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
      }
      .guide-header h1 span {
        color: var(--g-accent);
      }

      .mode-toggle {
        display: flex;
        gap: 8px;
      }
      .mode-toggle button {
        padding: 8px 16px;
        border: 1px solid var(--g-border);
        border-radius: 6px;
        background: var(--g-card);
        color: var(--g-dim);
        font: inherit;
        font-size: 13px;
        cursor: pointer;
      }
      .mode-toggle button.active {
        background: var(--g-accent);
        border-color: var(--g-accent);
        color: white;
      }

      .guide-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 32px 24px;
      }
      .guide-section {
        margin-bottom: 48px;
      }
      .guide-section h2 {
        margin: 0 0 8px;
        font-size: 18px;
        font-weight: 600;
      }
      .guide-section p {
        margin: 0 0 24px;
        color: var(--g-dim);
        font-size: 14px;
      }

      .component-grid {
        display: grid;
        gap: 24px;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      }

      figure {
        margin: 0 0 24px;
        background: var(--g-card);
        border: 1px solid var(--g-border);
        border-radius: 12px;
        overflow: hidden;
      }
      figure.drawer {
        background: var(--g-muted);
      }
      figure.drawer figcaption {
        background: transparent;
      }
      figcaption {
        padding: 12px 16px;
        background: var(--g-muted);
        border-bottom: 1px solid var(--g-border);
        font-size: 13px;
        font-weight: 500;
        color: var(--g-dim);
      }

      .preview {
        padding: 24px;
      }
      .preview.flush {
        padding: 0;
      }
      .preview.drawer {
        height: 400px;
        position: relative;
      }
      .preview.drawer.collapsed {
        height: 80px;
      }
      .preview.page {
        height: 500px;
      }
      .preview.page.tall {
        height: 600px;
      }

      .color-grid {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      }
      .color-swatch {
        display: flex;
        flex-direction: column;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid var(--g-border);
      }
      .color-swatch-preview {
        height: 60px;
      }
      .color-swatch-info {
        padding: 8px 10px;
        background: var(--g-card);
        font-size: 11px;
      }
      .color-swatch-info code {
        display: block;
        color: var(--g-dim);
        font-family: ui-monospace, monospace;
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <header class="guide-header">
      <h1><span>‚óÜ</span> libchat Design Guide</h1>
      <div class="mode-toggle">
        <button id="light-mode" class="active">‚òÄÔ∏è Light</button>
        <button id="dark-mode">üåô Dark</button>
      </div>
    </header>

    <main class="guide-content">
      <!-- Color Tokens Section -->
      <section class="guide-section">
        <h2>Color Tokens</h2>
        <p>
          CSS custom properties for consistent theming. These values change
          automatically with light/dark mode.
        </p>

        <div class="color-grid" id="color-tokens">
          <!-- Populated by JavaScript -->
        </div>
      </section>

      <!-- Typography Section -->
      <section class="guide-section">
        <h2>Typography</h2>
        <p>Text styles used throughout chat components.</p>

        <div class="component-grid">
          <figure>
            <figcaption>Headers</figcaption>
            <div class="preview">
              <chat-demo-typography></chat-demo-typography>
            </div>
          </figure>

          <figure>
            <figcaption>Body Text</figcaption>
            <div class="preview"><chat-demo-body></chat-demo-body></div>
          </figure>
        </div>
      </section>

      <!-- Buttons Section -->
      <section class="guide-section">
        <h2>Buttons</h2>
        <p>Interactive elements for actions and navigation.</p>

        <div class="component-grid">
          <figure>
            <figcaption>Icon Buttons</figcaption>
            <div class="preview">
              <chat-demo-icon-buttons></chat-demo-icon-buttons>
            </div>
          </figure>

          <figure>
            <figcaption>Submit Button</figcaption>
            <div class="preview">
              <chat-demo-submit-buttons></chat-demo-submit-buttons>
            </div>
          </figure>

          <figure>
            <figcaption>Form Button (Full Width)</figcaption>
            <div class="preview">
              <chat-demo-form-button></chat-demo-form-button>
            </div>
          </figure>
        </div>
      </section>

      <!-- Form Elements Section -->
      <section class="guide-section">
        <h2>Form Elements</h2>
        <p>Input controls for user interaction.</p>

        <div class="component-grid">
          <figure>
            <figcaption>Text Input</figcaption>
            <div class="preview"><chat-demo-input></chat-demo-input></div>
          </figure>

          <figure>
            <figcaption>Textarea</figcaption>
            <div class="preview"><chat-demo-textarea></chat-demo-textarea></div>
          </figure>
        </div>
      </section>

      <!-- Messages Section -->
      <section class="guide-section">
        <h2>Messages</h2>
        <p>Chat message bubbles for different roles.</p>

        <figure class="full-width">
          <figcaption>Message Types</figcaption>
          <div class="preview flush">
            <chat-demo-messages></chat-demo-messages>
          </div>
        </figure>
      </section>

      <!-- Header Section -->
      <section class="guide-section">
        <h2>Header</h2>
        <p>Title bar with optional controls for drawer and page components.</p>

        <figure class="full-width">
          <figcaption>Chat Header</figcaption>
          <div class="preview flush"><chat-demo-header></chat-demo-header></div>
        </figure>
      </section>

      <!-- Details/Summary Section -->
      <section class="guide-section">
        <h2>Expandable Content</h2>
        <p>Collapsible sections for tool calls and additional details.</p>

        <div class="component-grid">
          <figure>
            <figcaption>Details/Summary</figcaption>
            <div class="preview"><chat-demo-details></chat-demo-details></div>
          </figure>
        </div>
      </section>

      <!-- Code Blocks Section -->
      <section class="guide-section">
        <h2>Code Blocks</h2>
        <p>Styled code snippets within messages.</p>

        <figure class="full-width">
          <figcaption>Pre-formatted Code</figcaption>
          <div class="preview flush"><chat-demo-code></chat-demo-code></div>
        </figure>
      </section>

      <!-- User Authentication Section -->
      <section class="guide-section">
        <h2>User Authentication</h2>
        <p>Login forms and logged-in state display.</p>

        <div class="component-grid">
          <figure>
            <figcaption>Login Form</figcaption>
            <div class="preview"><chat-demo-login></chat-demo-login></div>
          </figure>

          <figure>
            <figcaption>Logged In State</figcaption>
            <div class="preview">
              <chat-demo-logged-in></chat-demo-logged-in>
            </div>
          </figure>

          <figure>
            <figcaption>Error State</figcaption>
            <div class="preview">
              <chat-demo-login-error></chat-demo-login-error>
            </div>
          </figure>
        </div>
      </section>

      <!-- Composite Components Section -->
      <section class="guide-section">
        <h2>Composite Components</h2>
        <p>Full component layouts combining multiple elements.</p>

        <div class="component-grid">
          <figure class="drawer">
            <figcaption>Chat Drawer</figcaption>
            <div class="preview flush drawer">
              <chat-demo-drawer></chat-demo-drawer>
            </div>
          </figure>

          <figure class="drawer">
            <figcaption>Chat Drawer (Collapsed)</figcaption>
            <div class="preview flush drawer collapsed">
              <chat-demo-drawer-collapsed></chat-demo-drawer-collapsed>
            </div>
          </figure>
        </div>

        <figure class="full-width" style="margin-top: 24px">
          <figcaption>Chat Page (Empty State)</figcaption>
          <div class="preview flush page">
            <chat-demo-page-empty></chat-demo-page-empty>
          </div>
        </figure>

        <figure class="full-width">
          <figcaption>Chat Page (With Messages)</figcaption>
          <div class="preview flush page tall">
            <chat-demo-page></chat-demo-page>
          </div>
        </figure>
      </section>
    </main>

    <script type="module">
      // Import styles directly from source
      import { baseStyles } from "./styles/base.js";
      import { drawerStyles } from "./styles/drawer.js";
      import { pageStyles } from "./styles/page.js";
      import { userStyles } from "./styles/user.js";

      // Color tokens for the swatch display
      const colorTokens = [
        { name: "--chat-text", label: "Text" },
        { name: "--chat-text-muted", label: "Text Muted" },
        { name: "--chat-text-inverse", label: "Text Inverse" },
        { name: "--chat-bg", label: "Background" },
        { name: "--chat-bg-alt", label: "Background Alt" },
        { name: "--chat-bg-muted", label: "Background Muted" },
        { name: "--chat-border", label: "Border" },
        { name: "--chat-accent", label: "Accent" },
        { name: "--chat-accent-hover", label: "Accent Hover" },
        { name: "--chat-accent-muted", label: "Accent Muted" },
        { name: "--chat-error", label: "Error" },
      ];

      // Create a reference element to read CSS custom property values
      class ColorReference extends HTMLElement {
        constructor() {
          super();
          this.attachShadow({ mode: "open" });
          this.shadowRoot.innerHTML = `<style>${baseStyles}</style><div></div>`;
        }
      }
      customElements.define("color-reference", ColorReference);

      // Render color swatches
      function renderColorTokens() {
        const container = document.getElementById("color-tokens");
        const refEl = document.createElement("color-reference");
        document.body.appendChild(refEl);
        const styles = getComputedStyle(
          refEl.shadowRoot.querySelector("div").parentElement.host,
        );

        container.innerHTML = colorTokens
          .map((token) => {
            const value = styles.getPropertyValue(token.name).trim();
            return `
          <div class="color-swatch">
            <div class="color-swatch-preview" style="background: var(${token.name}, ${value});"></div>
            <div class="color-swatch-info">
              <strong>${token.label}</strong>
              <code>${token.name}</code>
            </div>
          </div>
        `;
          })
          .join("");

        // Remove reference element
        refEl.remove();
      }

      // Shared demo styles
      const demoStyles = `
        .row { display: flex; gap: 8px; align-items: center; margin-bottom: 12px; }
        .row:last-child { margin-bottom: 0; }
        .label { font-size: 12px; color: var(--chat-text-muted); min-width: 80px; }
        .group { margin-bottom: 16px; }
        .group:last-child { margin-bottom: 0; }
      `;
      const userHostStyles =
        userStyles + `:host { display: block; max-width: none; padding: 0; }`;
      const drawerHostStyles =
        drawerStyles +
        `:host { position: absolute; right: 16px; bottom: 16px; width: calc(100% - 32px); }`;
      const pageHostStyles =
        pageStyles + `:host { background: var(--chat-bg-alt); }`;

      // Base demo component with factory
      class DemoComponent extends HTMLElement {
        constructor() {
          super();
          this.attachShadow({ mode: "open" });
        }
        init(styles, html) {
          this.shadowRoot.innerHTML = `<style>${baseStyles}${styles}</style>${html}`;
        }
      }

      const define = (name, styles, html, setup) => {
        customElements.define(
          name,
          class extends DemoComponent {
            connectedCallback() {
              this.init(styles, html);
              setup?.(this);
            }
          },
        );
      };

      define(
        "chat-demo-typography",
        "",
        `
        <header style="border:none;height:auto;padding:0"><h1><mark>‚óÜ</mark>Header Title</h1></header>`,
      );

      define(
        "chat-demo-body",
        "",
        `
        <p style="margin:0 0 8px;color:var(--chat-text)">Primary body text in default color.</p>
        <p style="margin:0;color:var(--chat-text-muted)">Muted text for secondary information.</p>`,
      );

      define(
        "chat-demo-icon-buttons",
        demoStyles + `.btn-icon{flex-shrink:initial}`,
        `
        <div class="row"><span class="label">Default</span>
          <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚úï</button>
          <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚§¢</button>
          <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚àí</button></div>
        <div class="row"><span class="label">Hover</span>
          <button class="btn-icon" style="background:var(--chat-accent-muted);color:var(--chat-text)">‚úï</button>
          <button class="btn-icon" style="background:var(--chat-accent-muted);color:var(--chat-text)">‚§¢</button>
          <button class="btn-icon" style="background:var(--chat-accent-muted);color:var(--chat-text)">‚àí</button></div>`,
      );

      define(
        "chat-demo-submit-buttons",
        demoStyles + `.row{gap:12px}button[type="submit"]{position:static}`,
        `
        <div class="row"><span class="label">Default</span><button type="submit" class="btn-icon">‚Üë</button></div>
        <div class="row"><span class="label">Hover</span><button type="submit" class="btn-icon" style="background:var(--chat-accent-hover)">‚Üë</button></div>
        <div class="row"><span class="label">Disabled</span><button type="submit" class="btn-icon" disabled>‚Üë</button></div>`,
      );

      define(
        "chat-demo-form-button",
        userHostStyles + demoStyles + `form{gap:12px}.label{margin-bottom:8px}`,
        `
        <form><div><div class="label">Default</div><button type="submit">Sign In</button></div></form>`,
      );

      define(
        "chat-demo-input",
        userHostStyles + `form{gap:16px}`,
        `
        <form>
          <div><label>Email</label><input type="email" placeholder="you@example.com"></div>
          <div><label>Focused</label><input type="text" value="With content" style="border-color:var(--chat-accent);box-shadow:0 0 0 2px var(--chat-accent-muted)"></div>
        </form>`,
      );

      define(
        "chat-demo-textarea",
        demoStyles + `textarea{padding-right:14px}`,
        `
        <div class="group"><div class="label">Default</div><textarea placeholder="Type a message..."></textarea></div>
        <div class="group"><div class="label">Disabled</div><textarea disabled placeholder="Input disabled..."></textarea></div>`,
      );

      define(
        "chat-demo-messages",
        `main{background:var(--chat-bg-alt);padding:var(--chat-gap);border-radius:0}`,
        `
        <main>
          <article role="user">This is a user message. It appears on the right with the accent color background.</article>
          <article role="assistant">This is an assistant response. It appears on the left with the default text color and no background.</article>
          <article role="error">This is an error message displayed in the error color.</article>
        </main>`,
      );

      define(
        "chat-demo-header",
        "",
        `
        <header><h1><mark>‚óÜ</mark>Chat Assistant</h1>
          <button class="btn-icon">‚§¢</button><button class="btn-icon">‚àí</button><button class="btn-icon">‚úï</button></header>`,
      );

      define(
        "chat-demo-details",
        "",
        `
        <details><summary>üîß Tool call: search_documents</summary><pre>{ "query": "design patterns", "limit": 5 }</pre></details>
        <details open><summary>üîß Tool result: search_documents</summary><pre>Found 3 matching documents...</pre></details>`,
      );

      define(
        "chat-demo-code",
        `article{padding:var(--chat-gap)}`,
        `
        <article role="assistant">Here's an example code snippet:
          <pre>function greet(name) {
  return \`Hello, \${name}!\`;
}

console.log(greet('World'));</pre></article>`,
      );

      define(
        "chat-demo-login",
        userHostStyles,
        `
        <form><div><label>Email</label><input type="email" placeholder="you@example.com"></div>
          <div><label>Password</label><input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
          <button type="submit">Sign In</button></form>`,
      );

      define(
        "chat-demo-logged-in",
        userHostStyles,
        `
        <aside><p>Signed in as <strong>user@example.com</strong></p><button>Sign Out</button></aside>`,
      );

      define(
        "chat-demo-login-error",
        userHostStyles,
        `
        <form><output>Invalid email or password. Please try again.</output>
          <div><label>Email</label><input type="email" value="user@example.com"></div>
          <div><label>Password</label><input type="password" value="wrong"></div>
          <button type="submit">Sign In</button></form>`,
      );

      define(
        "chat-demo-drawer",
        drawerHostStyles + `:host{height:calc(100% - 32px)}`,
        `
        <header><h1><mark>‚óÜ</mark>Chat</h1>
          <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚§¢</button>
          <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚àí</button>
          <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚úï</button></header>
        <main><article role="user">Hello!</article><article role="assistant">Hi there! How can I help you today?</article></main>
        <footer><form><textarea placeholder="Type a message..."></textarea><button type="submit" class="btn-icon">‚Üë</button></form></footer>`,
      );

      define(
        "chat-demo-drawer-collapsed",
        drawerHostStyles +
          `:host{height:48px;overflow:hidden}header{border-radius:11px;border-bottom:none}`,
        `
        <header><h1><mark>‚óÜ</mark>Chat</h1>
          <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚§¢</button>
          <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">+</button>
          <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚úï</button></header>`,
      );

      define(
        "chat-demo-page-empty",
        pageHostStyles,
        `
        <section><h2><mark>‚óÜ</mark>How can I help?</h2>
          <form><textarea placeholder="Ask me anything..."></textarea><button type="submit" class="btn-icon">‚Üë</button></form></section>`,
        (el) => el.setAttribute("data-empty", ""),
      );

      define(
        "chat-demo-page",
        pageHostStyles,
        `
        <main>
          <article role="user">Can you explain how CSS custom properties work?</article>
          <article role="assistant">CSS custom properties (also known as CSS variables) are entities defined by CSS authors that contain specific values to be reused throughout a document.
            <pre>:root {
  --primary-color: #2563eb;
  --spacing: 16px;
}

.button {
  background: var(--primary-color);
  padding: var(--spacing);
}</pre>
            They're set using the <code>--</code> prefix and accessed using the <code>var()</code> function.</article>
          <article role="user">That's helpful, thanks!</article>
        </main>
        <footer><form><textarea placeholder="Type a message..."></textarea>
          <button type="submit" class="btn-icon">‚Üë</button><button id="new" class="btn-icon">+</button></form></footer>`,
      );

      // Theme toggle
      const [lightBtn, darkBtn] = [
        document.getElementById("light-mode"),
        document.getElementById("dark-mode"),
      ];
      const setTheme = (theme) => {
        const isDark = theme === "dark";
        document.body.classList.toggle("dark", isDark);
        document.documentElement.style.colorScheme = theme;
        lightBtn.classList.toggle("active", !isDark);
        darkBtn.classList.toggle("active", isDark);
        setTimeout(renderColorTokens, 50);
      };
      lightBtn.onclick = () => setTheme("light");
      darkBtn.onclick = () => setTheme("dark");
      renderColorTokens();
    </script>
  </body>
</html>
