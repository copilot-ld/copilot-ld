<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>libchat Design Guide</title>
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }
      :root {
        --g-bg: #f5f5f5;
        --g-card: white;
        --g-muted: #f9fafb;
        --g-border: #e5e7eb;
        --g-text: #1f2937;
        --g-dim: #6b7280;
        --g-accent: #2563eb;
      }
      body.dark {
        --g-bg: #0a0a0a;
        --g-card: #111827;
        --g-muted: #1f2937;
        --g-border: #374151;
        --g-text: #f9fafb;
        --g-dim: #9ca3af;
      }
      body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: var(--g-bg);
        color: var(--g-text);
      }

      .guide-header {
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 24px;
        background: var(--g-card);
        border-bottom: 1px solid var(--g-border);
      }
      .guide-header h1 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
      }
      .guide-header h1 span {
        color: var(--g-accent);
      }
      .mode-toggle {
        display: flex;
        gap: 8px;
      }
      .mode-toggle button {
        padding: 8px 16px;
        border: 1px solid var(--g-border);
        border-radius: 6px;
        background: var(--g-card);
        color: var(--g-dim);
        font: inherit;
        font-size: 13px;
        cursor: pointer;
      }
      .mode-toggle button.active {
        background: var(--g-accent);
        border-color: var(--g-accent);
        color: white;
      }

      main.guide {
        max-width: 1200px;
        margin: 0 auto;
        padding: 32px 24px;
      }
      section {
        margin-bottom: 48px;
      }
      section > h2 {
        margin: 0 0 8px;
        font-size: 18px;
        font-weight: 600;
      }
      section > p {
        margin: 0 0 24px;
        color: var(--g-dim);
        font-size: 14px;
      }
      .grid {
        display: grid;
        gap: 24px;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      }

      figure {
        margin: 0 0 24px;
        background: var(--g-card);
        border: 1px solid var(--g-border);
        border-radius: 12px;
        overflow: hidden;
      }
      figure.drawer {
        background: var(--g-muted);
      }
      figcaption {
        padding: 12px 16px;
        background: var(--g-muted);
        border-bottom: 1px solid var(--g-border);
        font-size: 13px;
        font-weight: 500;
        color: var(--g-dim);
      }
      figure.drawer figcaption {
        background: transparent;
      }
      .preview {
        padding: 24px;
      }
      figure[data-flush] .preview {
        padding: 0;
      }
      figure[data-height] .preview {
        position: relative;
      }
      .color-grid {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      }
    </style>
  </head>
  <body>
    <header class="guide-header">
      <h1><span>‚óÜ</span> libchat Design Guide</h1>
      <div class="mode-toggle">
        <button id="light-mode" class="active">‚òÄÔ∏è Light</button>
        <button id="dark-mode">üåô Dark</button>
      </div>
    </header>

    <main class="guide" id="guide"></main>

    <script type="module">
      import { baseStyles } from "./styles/base.js";
      import { drawerStyles } from "./styles/drawer.js";
      import { pageStyles } from "./styles/page.js";
      import { userStyles } from "./styles/user.js";

      // --- Guide structure ---
      const sections = [
        {
          title: "Color Tokens",
          desc: "CSS custom properties for consistent theming. Values change with light/dark mode.",
          id: "color-tokens",
        },
        {
          title: "Spacing Scale",
          desc: "Consistent spacing values for padding, margins, and gaps. Based on a 4px base unit.",
          id: "spacing-scale",
        },
        {
          title: "Typography",
          desc: "Text styles used throughout chat components.",
          grid: [
            ["Headers", "typography"],
            ["Body Text", "body"],
          ],
        },
        {
          title: "Buttons",
          desc: "Interactive elements for actions and navigation.",
          grid: [
            ["Icon Buttons", "icon-buttons"],
            ["Submit Button", "submit-buttons"],
            ["Form Button (Full Width)", "form-button"],
          ],
        },
        {
          title: "Form Elements",
          desc: "Input controls for user interaction.",
          grid: [
            ["Text Input", "input"],
            ["Textarea", "textarea"],
          ],
        },
        {
          title: "Messages",
          desc: "Chat message bubbles for different roles.",
          items: [["Message Types", "messages", "flush"]],
        },
        {
          title: "Header",
          desc: "Title bar with optional controls for drawer and page components.",
          items: [["Chat Header", "header", "flush"]],
        },
        {
          title: "Expandable Content",
          desc: "Collapsible sections for tool calls and additional details.",
          grid: [["Details/Summary", "details"]],
        },
        {
          title: "Code Blocks",
          desc: "Styled code snippets within messages.",
          items: [["Pre-formatted Code", "code", "flush"]],
        },
        {
          title: "User Authentication",
          desc: "Login forms and logged-in state display.",
          grid: [
            ["Login Form", "login"],
            ["Logged In State", "logged-in"],
            ["Error State", "login-error"],
          ],
        },
        {
          title: "Composite Components",
          desc: "Full component layouts combining multiple elements.",
          grid: [
            ["Chat Drawer", "drawer", "flush drawer", 400],
            ["Chat Drawer (Collapsed)", "drawer-collapsed", "flush drawer", 80],
          ],
          items: [
            ["Chat Page (Empty State)", "page-empty", "flush", 500],
            ["Chat Page (With Messages)", "page", "flush", 600],
          ],
        },
      ];

      // Render guide structure
      const guide = document.getElementById("guide");
      for (const sec of sections) {
        const el = document.createElement("section");
        el.innerHTML = `<h2>${sec.title}</h2><p>${sec.desc}</p>`;
        if (sec.id)
          el.innerHTML += `<div class="color-grid" id="${sec.id}"></div>`;
        const figure = (label, name, cls = "", h) => {
          const attrs = [
            cls.includes("flush") && 'data-flush=""',
            h && `data-height="${h}"`,
          ]
            .filter(Boolean)
            .join(" ");
          const figCls = cls.includes("drawer") ? ' class="drawer"' : "";
          return `<figure${figCls}${attrs ? " " + attrs : ""}><figcaption>${label}</figcaption><div class="preview"${h ? ` style="height:${h}px"` : ""}><chat-demo-${name}></chat-demo-${name}></div></figure>`;
        };
        if (sec.grid)
          el.innerHTML += `<div class="grid">${sec.grid.map((f) => figure(...f)).join("")}</div>`;
        if (sec.items)
          el.innerHTML += sec.items.map((f) => figure(...f)).join("");
        guide.appendChild(el);
      }

      // --- Color tokens ---
      const tokenNames = [
        "text",
        "text-muted",
        "text-inverse",
        "bg",
        "bg-alt",
        "bg-muted",
        "border",
        "accent",
        "accent-hover",
        "accent-muted",
        "error",
      ];

      const spacingTokens = [
        {
          name: "space-xs",
          label: "XS",
          desc: "Tight spacing: label gaps, summary padding",
        },
        {
          name: "space-sm",
          label: "SM",
          desc: "Small spacing: icon margins, button gaps",
        },
        {
          name: "space-md",
          label: "MD",
          desc: "Medium spacing: message padding, input padding",
        },
        {
          name: "space-lg",
          label: "LG",
          desc: "Large spacing: section padding, form gaps",
        },
        {
          name: "space-xl",
          label: "XL",
          desc: "Extra large: responsive content padding",
        },
        {
          name: "space-2xl",
          label: "2XL",
          desc: "Maximum spacing: page margins, large gaps",
        },
      ];

      const toLabel = (s) =>
        s
          .split("-")
          .map((w) => w[0].toUpperCase() + w.slice(1))
          .join(" ");

      function renderColorTokens() {
        const ref = document.createElement("div");
        const shadow = ref.attachShadow({ mode: "open" });
        shadow.innerHTML = `<style>${baseStyles}</style><span></span>`;
        document.body.appendChild(ref);
        const cs = getComputedStyle(shadow.querySelector("span"));
        document.getElementById("color-tokens").innerHTML = tokenNames
          .map((n) => {
            const name = `--chat-${n}`,
              val = cs.getPropertyValue(name).trim();
            return `<div style="border-radius:8px;overflow:hidden;border:1px solid var(--g-border)">
              <div style="height:60px;background:var(${name},${val})"></div>
              <div style="padding:8px 10px;background:var(--g-card);font-size:11px"><strong>${toLabel(n)}</strong><code style="display:block;color:var(--g-dim);font-family:ui-monospace,monospace">${name}</code></div></div>`;
          })
          .join("");
        ref.remove();
      }

      function renderSpacingScale() {
        const ref = document.createElement("div");
        const shadow = ref.attachShadow({ mode: "open" });
        shadow.innerHTML = `<style>${baseStyles}</style><span></span>`;
        document.body.appendChild(ref);
        const cs = getComputedStyle(shadow.querySelector("span"));
        document.getElementById("spacing-scale").innerHTML = spacingTokens
          .map((t) => {
            const name = `--chat-${t.name}`,
              val = cs.getPropertyValue(name).trim();
            return `<div style="border-radius:8px;overflow:hidden;border:1px solid var(--g-border)">
              <div style="height:60px;display:flex;align-items:center;justify-content:center;background:var(--g-muted)">
                <div style="width:${val};height:${val};background:var(--g-accent);border-radius:2px"></div>
              </div>
              <div style="padding:8px 10px;background:var(--g-card);font-size:11px">
                <strong>${t.label}</strong> <span style="color:var(--g-dim)">(${val})</span>
                <code style="display:block;color:var(--g-dim);font-family:ui-monospace,monospace;margin-top:2px">${name}</code>
                <span style="display:block;color:var(--g-dim);font-size:10px;margin-top:4px">${t.desc}</span>
              </div></div>`;
          })
          .join("");
        ref.remove();
      }

      // --- Demo components ---
      const SHARED = {
        // Shared style fragments
        row: `.row{display:flex;gap:8px;align-items:center;margin-bottom:12px}.row:last-child{margin-bottom:0}.label{font-size:12px;color:var(--chat-text-muted);min-width:80px}`,
        group: `.group{margin-bottom:16px}.group:last-child{margin-bottom:0}`,
        user: userStyles + `:host{display:block;max-width:none;padding:0}`,
        drawer:
          drawerStyles +
          `:host{position:absolute;right:16px;bottom:16px;width:calc(100% - 32px)}`,
        page: pageStyles + `:host{background:var(--chat-bg-alt)}`,
      };

      // Demo registry: [extraStyles, html, attrs]
      const demos = {
        typography: [
          "",
          `<header style="border:none;height:auto;padding:0"><h1><mark>‚óÜ</mark>Header Title</h1></header>`,
        ],

        body: [
          "",
          `<p style="margin:0 0 8px;color:var(--chat-text)">Primary body text in default color.</p>
          <p style="margin:0;color:var(--chat-text-muted)">Muted text for secondary information.</p>`,
        ],

        "icon-buttons": [
          SHARED.row + `.btn-icon{flex-shrink:initial}`,
          `
          <div class="row"><span class="label">Default</span>
            <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚úï</button>
            <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚§¢</button>
            <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚àí</button></div>
          <div class="row"><span class="label">Hover</span>
            <button class="btn-icon" style="background:var(--chat-accent-muted);color:var(--chat-text)">‚úï</button>
            <button class="btn-icon" style="background:var(--chat-accent-muted);color:var(--chat-text)">‚§¢</button>
            <button class="btn-icon" style="background:var(--chat-accent-muted);color:var(--chat-text)">‚àí</button></div>`,
        ],

        "submit-buttons": [
          SHARED.row + `.row{gap:12px}button[type="submit"]{position:static}`,
          `
          <div class="row"><span class="label">Default</span><button type="submit" class="btn-icon">‚Üë</button></div>
          <div class="row"><span class="label">Hover</span><button type="submit" class="btn-icon" style="background:var(--chat-accent-hover)">‚Üë</button></div>
          <div class="row"><span class="label">Disabled</span><button type="submit" class="btn-icon" disabled>‚Üë</button></div>`,
        ],

        "form-button": [
          SHARED.user +
            SHARED.row +
            SHARED.group +
            `form{gap:12px}.label{margin-bottom:8px}`,
          `
          <form><div><div class="label">Default</div><button type="submit">Sign In</button></div></form>`,
        ],

        input: [
          SHARED.user + `form{gap:16px}`,
          `
          <form>
            <div><label>Email</label><input type="email" placeholder="you@example.com"></div>
            <div><label>Focused</label><input type="text" value="With content" style="border-color:var(--chat-accent);box-shadow:0 0 0 2px var(--chat-accent-muted)"></div>
          </form>`,
        ],

        textarea: [
          SHARED.row + SHARED.group + `textarea{padding-right:14px}`,
          `
          <div class="group"><div class="label">Default</div><textarea placeholder="Type a message..."></textarea></div>
          <div class="group"><div class="label">Disabled</div><textarea disabled placeholder="Input disabled..."></textarea></div>`,
        ],

        messages: [
          `main{background:var(--chat-bg-alt);padding:var(--chat-gap);border-radius:0}`,
          `
          <main>
            <article role="user">This is a user message. It appears on the right with the accent color background.</article>
            <article role="assistant">This is an assistant response. It appears on the left with the default text color and no background.</article>
            <article role="error">This is an error message displayed in the error color.</article>
          </main>`,
        ],

        header: [
          "",
          `<header><h1><mark>‚óÜ</mark>Chat Assistant</h1>
          <button class="btn-icon">‚§¢</button><button class="btn-icon">‚àí</button><button class="btn-icon">‚úï</button></header>`,
        ],

        details: [
          "",
          `
          <details><summary>üîß Tool call: search_documents</summary><pre>{ "query": "design patterns", "limit": 5 }</pre></details>
          <details open><summary>üîß Tool result: search_documents</summary><pre>Found 3 matching documents...</pre></details>`,
        ],

        code: [
          `article{padding:var(--chat-gap)}`,
          `
          <article role="assistant">Here's an example code snippet:
            <pre>function greet(name) {
  return \`Hello, \${name}!\`;
}

console.log(greet('World'));</pre></article>`,
        ],

        login: [
          SHARED.user,
          `
          <form><div><label>Email</label><input type="email" placeholder="you@example.com"></div>
            <div><label>Password</label><input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
            <button type="submit">Sign In</button></form>`,
        ],

        "logged-in": [
          SHARED.user,
          `<aside><p>Signed in as <strong>user@example.com</strong></p><button>Sign Out</button></aside>`,
        ],

        "login-error": [
          SHARED.user,
          `
          <form><output>Invalid email or password. Please try again.</output>
            <div><label>Email</label><input type="email" value="user@example.com"></div>
            <div><label>Password</label><input type="password" value="wrong"></div>
            <button type="submit">Sign In</button></form>`,
        ],

        drawer: [
          SHARED.drawer + `:host{height:calc(100% - 32px)}`,
          `
          <header><h1><mark>‚óÜ</mark>Chat</h1>
            <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚§¢</button>
            <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚àí</button>
            <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚úï</button></header>
          <main><article role="user">Hello!</article><article role="assistant">Hi there! How can I help you today?</article></main>
          <footer><form><textarea placeholder="Type a message..."></textarea><button type="submit" class="btn-icon">‚Üë</button></form></footer>`,
        ],

        "drawer-collapsed": [
          SHARED.drawer +
            `:host{height:48px;overflow:hidden}header{border-radius:11px;border-bottom:none}`,
          `
          <header><h1><mark>‚óÜ</mark>Chat</h1>
            <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚§¢</button>
            <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">+</button>
            <button class="btn-icon" style="background:transparent;color:var(--chat-text-muted)">‚úï</button></header>`,
        ],

        "page-empty": [
          SHARED.page,
          `
          <section><h2><mark>‚óÜ</mark>How can I help?</h2>
            <form><textarea placeholder="Ask me anything..."></textarea><button type="submit" class="btn-icon">‚Üë</button></form></section>`,
          { "data-empty": "" },
        ],

        page: [
          SHARED.page,
          `
          <main>
            <article role="user">Can you explain how CSS custom properties work?</article>
            <article role="assistant">CSS custom properties (also known as CSS variables) are entities defined by CSS authors that contain specific values to be reused throughout a document.
              <pre>:root {
  --primary-color: #2563eb;
  --spacing: 16px;
}

.button {
  background: var(--primary-color);
  padding: var(--spacing);
}</pre>
              They're set using the <code>--</code> prefix and accessed using the <code>var()</code> function.</article>
            <article role="user">That's helpful, thanks!</article>
          </main>
          <footer><form><textarea placeholder="Type a message..."></textarea>
            <button type="submit" class="btn-icon">‚Üë</button><button id="new" class="btn-icon">+</button></form></footer>`,
        ],
      };

      // Register all demo components
      for (const [name, [styles, html, attrs]] of Object.entries(demos)) {
        customElements.define(
          `chat-demo-${name}`,
          class extends HTMLElement {
            connectedCallback() {
              this.attachShadow({ mode: "open" }).innerHTML =
                `<style>${baseStyles}${styles}</style>${html}`;
              if (attrs)
                for (const [k, v] of Object.entries(attrs))
                  this.setAttribute(k, v);
            }
          },
        );
      }

      // --- Theme toggle ---
      const [lightBtn, darkBtn] = [
        document.getElementById("light-mode"),
        document.getElementById("dark-mode"),
      ];
      const setTheme = (dark) => {
        document.body.classList.toggle("dark", dark);
        document.documentElement.style.colorScheme = dark ? "dark" : "light";
        lightBtn.classList.toggle("active", !dark);
        darkBtn.classList.toggle("active", dark);
        setTimeout(() => {
          renderColorTokens();
          renderSpacingScale();
        }, 50);
      };
      lightBtn.onclick = () => setTheme(false);
      darkBtn.onclick = () => setTheme(true);
      renderColorTokens();
      renderSpacingScale();
    </script>
  </body>
</html>
