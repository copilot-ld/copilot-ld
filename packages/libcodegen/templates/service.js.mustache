/* eslint-env node */
import { {{#importNamespaces}}{{name}}{{^isLast}}, {{/isLast}}{{/importNamespaces}} } from "@copilot-ld/libtype";

/**
 * Base class for {{serviceName}} service implementation
 */
export class {{className}} {
  config;

  /**
   * Creates a new {{serviceName}} service instance
   * @param {object} config - Service configuration
   */
  constructor(config) {
    if (!config) throw new Error("config is required");
    this.config = config;
  }

{{#methods}}
  /**
   * Must be implemented by subclass
   * @param { {{requestTypeNamespace}}.{{requestType}} } _{{paramName}} - Request parameters
   * @returns { Promise<{{responseTypeNamespace}}.{{responseType}}> } Response object
   */
  async {{name}}(_{{paramName}}) {
    throw new Error("{{name}} not implemented");
  }

{{/methods}}
  /**
   * Creates gRPC handlers for this service instance
   * @returns { object } Map of method names to handler functions
   */
  getHandlers() {
    return {
{{#methods}}
      {{name}}: async (call) => {
        // Validate and convert request
        const error = {{requestTypeNamespace}}.{{requestType}}.verify(call.request);
        if (error) throw new Error(`{{name}}: ${error}`);
        const req = {{requestTypeNamespace}}.{{requestType}}.fromObject(call.request);
        
        // Call implementation
        return await this.{{name}}(req);
      },
{{/methods}}
    };
  }
}
